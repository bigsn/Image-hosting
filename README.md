# Image hosting

# Image hosting
```text
**Директории и файлы:**

project/
├── app/ 
        ├── app.py       # Основной Python-бэкенд
        ├── database.py  # запросы к базе данных
        ├── http_handlier.py # запросы к серверу бекэнд
        ├── utils.py     # утилиты
├── requirements.txt      # Зависимости Python
├── Dockerfile            # Dockerfile для Python-бэкенда
├── docker-compose.yml    # Конфигурация Docker Compose
├── nginx.conf            # Конфигурация Nginx
├── images/               # Папка для хранения загруженных изображений (volume)
├── logs/                 # Папка для логов (volume)
└── static/               # Дополнительные статические файлы (CSS/JS, если применимо)
```

**Описание ключевых компонентов:**
1. **app.py:**
- Реализует обработку HTTP-запросов:
    - `GET /` — главная страница.
    - `POST /upload` — загрузка изображения.
- Выполняет:
    - Валидацию загружаемого файла (формат, размер).
    - Сохранение файла в папку `/images`.
    - Логирование действий в файл `app.log`.
  
2. **nginx.conf:**
- Раздает содержимое папки `/images` по маршруту `/images/<имя_файла>`.
- Проксирует запросы, не связанные со статикой, на Python-бэкенд.

3. **compose.yaml:**
- Определяет два сервиса:
    - `app` — Python-бэкенд.
    - `nginx` — Nginx-сервер.
- Создает два тома:
    - `images` — для хранения загруженных изображений.
    - `logs` — для хранения логов.
  
4. **images/:**
- Каталог, в который сохраняются все загруженные файлы.
- Подключается как volume для долговременного хранения.

5. **logs/:**
- Каталог, содержащий лог-файлы (`app.log`).
- Подключается как volume для сохранности данных между перезапусками.

------

### **4. Взаимодействие через сеть**

- Порты и маршруты:
    - Python-бэкенд:
    - Внешний порт: `8000` (для локальной отладки).
    - Nginx:
    - Внешний порт: `8080` (для пользователей).
    - Внутренняя сеть Docker связывает два контейнера:
    - Nginx обращается к Python-бэкенду по адресу `http://app:8000`.

------

### **5. Логическая схема**

1. **Пользовательский запрос:**
   Пользователь взаимодействует с системой через маршруты:
   - `/` — главная страница (обрабатывается бэкендом).
   - `/upload` — загрузка изображения (обрабатывается бэкендом).
   - `/images/<имя_файла>` — доступ к изображению (обрабатывается Nginx).
   - `/backup/` - создаёт резервную копию базы даннных

2. **Обработка запросов:**
   - Nginx:
       - Раздает статические файлы и загруженные изображения.
       - Переадресует запросы на Python-бэкенд, если маршрут не связан с интерфейсом и изображениями.
   - Python-бэкенд:
       - Принимает и обрабатывает запросы `/` , `/upload` и `/backup/`.
       - Сохраняет изображения и записывает логи.
     
3. **Хранение данных:**
   - Изображения:
       - хранятся в volume, подключенном как `/images`.
   - Логи:
       - хранятся в volume, подключенном как `/logs`.

------

### **6. Поток данных**

1. **Загрузка изображения:**
   - Пользователь отправляет файл на маршрут `/upload`.
   - Python-бэкенд:
       - Проверяет файл.
       - Сохраняет файл в `/images`.
       - Логирует действие.
   - Пользователю возвращается ссылка вида `/images/<имя_файла>`.
   
2. **Доступ к изображению:**
   - Пользователь отправляет запрос на `/images/<имя_файла>`.
   - Nginx проверяет файл в папке `/images` и возвращает его.

___   

## **5. Технические требования**

### **1. Язык программирования и библиотеки**

- **Язык программирования:** Python 3.12 или выше.
- Библиотеки Python:
- **Стандартная библиотека:** для работы с HTTP-запросами (`http.server`), файловой системой (`os`), логированием (`loguru`) и JSON.


#### **2. Сервер для раздачи статических файлов**

- Nginx:
- Настроен для раздачи изображений из папки `/images`.
- Должен проксировать все не относящиеся к статике запросы на Python-бэкенд.
- Порт для внешнего доступа: `80`.

#### **3. Контейнеризация**

- **Docker:**
  - Все компоненты приложения должны быть упакованы в контейнеры:
      - Python-бэкенд.
      - Nginx-сервер.
  - Должны быть использованы два Docker Volumes:
      - `images` — для хранения загруженных изображений.
      - `logs` — для хранения логов.
  - Для управления контейнерами используется Docker Compose.
- **Docker Compose:**
   - Конфигурация должна содержать:
       - Сервис для Python-бэкенда:
           - Название: `app`.
           - Порт: `8000`.
           - Подключение томов для изображений и логов.
       - Сервис для Nginx:
           - Название: `nginx`.
           - Порт: `80`.
        - Подключение тома для изображений.
           - Проксирование запросов на Python-бэкенд.

------

### **4. Хранилище данных**

- **Изображения:**
  - хранятся в локальной папке `/images`, подключенной через volume.
  - каждое изображение должно иметь уникальное имя, генерируемое Python-бэкендом.
  - ограничения:
      - Поддерживаемые форматы: `.jpg`, `.png`, `.gif`.
      - Максимальный размер файла: 5 МБ.
- **Логи:**
  - логи пишутся в файл `app.log`, расположенный в папке `/logs`.
  - лог-файл должен быть доступен для чтения между перезапусками контейнера.

------

### **5. Сетевые настройки**

- Взаимодействие контейнеров:
- Python-бэкенд (`app`) и Nginx (`nginx`) должны быть связаны через внутреннюю сеть Docker.
- Nginx проксирует запросы к Python-бэкенду по адресу `http://app:8000`.
- Порты:
- Nginx: доступен на порту `8080` для пользователей.
- Python-бэкенд: слушает запросы на порту `8000` (внутри контейнера).

------

### **6. Как обеспечиваем безопасность?**

- **Проверяем каждый файл перед загрузкой:**
- "Это точно картинка?" — принимаем только поддерживаемые форматы
- "Не слишком большая?" — следим за размером файла

- **Защищаем доступ к файлам:**
- Никаких "обходных путей" — только прямые ссылки от бэкенда
- Все ссылки вида `/images/название_файла`

То есть сначала убеждаемся, что файл безопасный,
а потом даём к нему доступ только через проверенный маршрут.
